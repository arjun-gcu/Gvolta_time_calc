<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>GCU - Gvolta充電時間計算機</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Roboto', sans-serif;
    background: linear-gradient(135deg, #2c3e50, #4ca1af);
    color: #f1f1f1;
    padding: 30px 20px;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    margin: 0;
  }
  .container {
    max-width: 800px;
    width: 100%;
    background-color: rgba(44, 62, 80, 0.85);
    border-radius: 12px;
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
    padding: 30px 40px;
    box-sizing: border-box;
  }
  h1 {
    text-align: center;
    margin-bottom: 25px;
    font-size: 1.8rem;
    font-weight: 700;
  }
  .section-title {
    margin-top: 15px;
    font-weight: bold;
    margin-bottom: 10px;
  }
  .input-group {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
  }
.input-with-unit {
  display: flex;
  align-items: center;
  gap: 6px;
  flex: 1;
}
.input-with-unit input {
  flex: 1;
  min-width: 100px;
  padding: 10px;
  font-size: 1rem;
  border: 1.8px solid #a0aec0;
  border-radius: 8px;
  background-color: #1e293b;
  color: #e2e8f0;
  box-shadow: inset 0 2px 6px rgba(0,0,0,0.6);
}
.unit-label {
  font-size: 0.95rem;
  color: #cbd5e1;
  white-space: nowrap;
}
  .note {
    font-size: 0.85rem;
    color: #d1d5db;
    margin-bottom: 15px;
  }
  .output-section {
    background-color: #334155;
    padding: 15px;
    border-radius: 10px;
    margin-top: 15px;
    text-align: center;
  }
  .output-wrapper {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 10px;
  }
  .output-box {
    background-color: #1e293b;
    padding: 8px;
    border-radius: 6px;
    font-size: 1.1rem;
    width: 120px;
    text-align: center;
    border: 1px solid #999;
    color: #f1f1f1;
  }
  .tag { font-weight: bold; }
  .buttons {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 15px;
  }
  button {
    flex: 1;
    padding: 10px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    box-shadow: 0 8px 15px rgba(0,0,0,0.3);
    transition: background 0.3s ease;
  }
  .calc-btn {
    background: linear-gradient(90deg, #4ca1af, #2c3e50);
    color: #e0e7ff;
  }
  .calc-btn:hover {
    background: linear-gradient(90deg, #3a91a0, #1f2d3c);
  }
  .clear-btn {
    background: #d9534f;
    color: white;
  }
  .clear-btn:hover {
    background: #c9302c;
  }
  .calculation-ref {
    background-color: #475569;
    padding: 15px;
    border-radius: 8px;
    font-size: 0.9rem;
    white-space: pre-line;
    margin-top: 20px;
  }
</style>
</head>
<body>
<div class="container">
  <h1>GCU - Gvolta充電時間計算機</h1>

<div class="section-title">3相AC入力（ブレーカー定格電流を入力）</div>
<div class="input-group">
  <label class="input-with-unit">
    <input type="number" id="inputVoltage" min="100" max="2000" placeholder="例: 200">
    <span class="unit-label">V</span>
  </label>
  <label class="input-with-unit">
    <input type="number" id="inputCurrent" min="10" max="500" placeholder="例: 30">
    <span class="unit-label">A</span>
  </label>
</div>

<div class="section-title">バッテリー情報</div>
<div class="input-group">
  <label class="input-with-unit">
    <input type="number" id="batteryVoltage" min="10" max="1000" placeholder="例: 48">
    <span class="unit-label">V</span>
  </label>
  <label class="input-with-unit">
    <input type="number" id="batteryAh" min="1" max="2000" placeholder="例: 200">
    <span class="unit-label">Ah</span>
  </label>
</div>

<div class="section-title">バッテリー現在チャージ（SoC）％</div>
<div class="input-with-unit" style="max-width:200px;">
  <input type="number" id="socPercent" min="0" max="100" placeholder="例: 50">
  <span class="unit-label">%</span>
</div>
<div class="note">
  例: 完全放電状態なら０％で、満充電状態なら１００％です。<br>
  例: 25%, 50%, 75%,　他。入力した％から１００％まで計算されます。
</div>

  <div class="buttons">
    <button class="calc-btn" onclick="calculateTime()">計算</button>
    <button class="clear-btn" onclick="clearFields()">削除</button>
  </div>

<div class="output-section">
  <span class="tag">GC出力電流（最大）：</span>
  <div class="output-wrapper" style="align-items:center;">
    <div style="display:flex; align-items:center; gap:6px;">
      <span>13kW GCチャージャー：</span>
      <div class="output-box" id="outputCurrent13">--</div>
      <span>アンペア</span>
    </div>
    <div style="display:flex; align-items:center; gap:6px;">
      <span>21kW GCチャージャー：</span>
      <div class="output-box" id="outputCurrent21">--</div>
      <span>アンペア</span>
    </div>
  </div>
</div>

<div class="output-section">
  <span class="tag">満充電までの所要時間：</span>
  <div class="output-wrapper" style="align-items:center;">
    <div style="display:flex; align-items:center; gap:6px;">
      <span>13kW GCチャージャー：</span>
      <div class="output-box" id="time13kw">--</div>
    </div>
    <div style="display:flex; align-items:center; gap:6px;">
      <span>21kW GCチャージャー：</span>
      <div class="output-box" id="time21kw">--</div>
    </div>
  </div>
</div>

  <div class="calculation-ref" id="calcRef">
    ※選択された値に基づいた詳細計算を表示します。
  </div>
</div>

<script>
function formatTime(hours) {
  const hr = Math.floor(hours);
  const min = Math.round((hours - hr) * 60);
  return `${hr} 時間 ${min} 分`;
}

function calculateTime() {
  const inputVoltage = parseFloat(document.getElementById("inputVoltage").value);
  let inputCurrent = parseFloat(document.getElementById("inputCurrent").value);
  const batteryVoltage = parseFloat(document.getElementById("batteryVoltage").value);
  const batteryAh = parseFloat(document.getElementById("batteryAh").value);
  const socPercent = parseFloat(document.getElementById("socPercent").value);

  const ref = [];

  if (isNaN(inputVoltage) || isNaN(inputCurrent) || isNaN(batteryVoltage) || isNaN(batteryAh) || isNaN(socPercent)) {
    alert("すべての入力欄に値を入力してください。");
    return;
  }
  if (socPercent < 0 || socPercent > 100) {
    alert("SoCは0〜100%の間で入力してください。");
    return;
  }

  inputCurrent *= 0.95;
  ref.push(`入力電流補正（-5%）：${inputCurrent.toFixed(2)} A`);

  const cutoffVoltage = batteryVoltage * 1.375;
  ref.push(`カットオフ電圧：${cutoffVoltage.toFixed(2)} V`);

  const inputPower = Math.sqrt(3) * inputVoltage * inputCurrent * 0.8 * 0.8;
  const rawOutputCurrent = inputPower / cutoffVoltage;
  const cLimit = 0.57 * batteryAh;
  const outputCurrent = Math.min(rawOutputCurrent, cLimit);

  const output13 = Math.min(outputCurrent, 160);
  const output21 = Math.min(outputCurrent, 320);

  document.getElementById("outputCurrent13").innerText = output13.toFixed(1);
  document.getElementById("outputCurrent21").innerText = output21.toFixed(1);

  ref.push(`計算出力電流（カットオフ基準）：${rawOutputCurrent.toFixed(2)} A`);
  ref.push(`Cレート上限（0.57C）：${cLimit.toFixed(2)} A`);
  ref.push(`13kW最終出力電流：${output13.toFixed(2)} A`);
  ref.push(`21kW最終出力電流：${output21.toFixed(2)} A`);

  const socRatio = (100 - socPercent) / 100;
  ref.push(`残SoC：${(socRatio * 100).toFixed(1)} %`);

  const baselineHours = 56 / 60;
  const scaleFactor = cLimit / outputCurrent;
  const actualFullChargeHours = baselineHours * scaleFactor;
  const totalHours = actualFullChargeHours * socRatio;

  const time13 = totalHours * (outputCurrent / output13);
  const time21 = totalHours * (outputCurrent / output21);

  document.getElementById("time13kw").innerText = formatTime(time13);
  document.getElementById("time21kw").innerText = formatTime(time21);

  ref.push(`\n【所要時間の内訳】`);
  ref.push(`満充電基準時間（0.57C時）：${baselineHours.toFixed(2)} 時間`);
  ref.push(`電流スケーリング係数：${scaleFactor.toFixed(2)}`);
  ref.push(`実際の満充電時間：${actualFullChargeHours.toFixed(2)} 時間`);
  ref.push(`残充電時間（線形）：${totalHours.toFixed(2)} 時間`);
  ref.push(`\n【最終結果】`);
  ref.push(`13kW: ${formatTime(time13)}`);
  ref.push(`21kW: ${formatTime(time21)}`);

  document.getElementById("calcRef").innerText = ref.join("\n");
}

function clearFields() {
  document.querySelectorAll("input").forEach(input => {
    const id = input.id;
    if (id !== "inputVoltage" && id !== "batteryVoltage") {
      input.value = "";
    }
  });
  document.getElementById("outputCurrent13").innerText = "--";
  document.getElementById("outputCurrent21").innerText = "--";
  document.getElementById("time13kw").innerText = "--";
  document.getElementById("time21kw").innerText = "--";
  document.getElementById("calcRef").innerText = "※選択された値に基づいた詳細計算を表示します。";
}
</script>
</body>
</html>

